var _this=this,ReadingToolUi=function(){function n(n){this.isPlaying=!1,this.wasPlaying=!1,this.hasChanged=!1,this.modalVisible=!1,this.settings=n,this.audio=n.hasAudio?new AudioPlayer(this.settings):new NullAudioPlayer}return n.prototype.setIsPlaying=function(n){this.isPlaying=n},n.prototype.setWasPlaying=function(n){this.wasPlaying=n},n.prototype.getWasPlaying=function(){return this.wasPlaying},n.prototype.getIsPlaying=function(){return this.isPlaying},n.prototype.toggleL1=function(){var n=$("#toggleL1").parent("li");n.hasClass("active")?(n.removeClass("active"),this.closeTextModal(),this.settings.asParallel?$("#textContent td.s").length>0?$("#textContent table td.f span").hide():$("#textContent p span").hide():$("#textContent p span").hide()):(n.addClass("active"),this.settings.asParallel?$("td.f p span").show():$("#textContent p span").show())},n.prototype.toggleL2=function(){var n=$("#toggleL2").parent("li");n.hasClass("active")?(n.removeClass("active"),this.closeTextModal(),$("td.s p span").hide()):(n.addClass("active"),$("td.s p span").show())},n.prototype.toggleQuickmode=function(){var n=$("#quickmode").parent("li");this.settings.quickmode=!this.settings.quickmode,this.settings.quickmode?n.addClass("active"):n.removeClass("active")},n.prototype.changeRead=function(n){var t=$("#totalWords").data("value");$.post(routes.reading.changeRead,{textId:this.settings.textId,direction:n,words:t},function(n){n.result=="OK"&&$("#timesRead").html(n.message)})},n.prototype.changeListened=function(n){$.post(routes.reading.changeListened,{textId:this.settings.textId,direction:n},function(n){n.result=="OK"&&$("#timesListened").html(n.message)})},n.prototype.openTextModal=function(n,t){if((!this.modalVisible||this.settings.modalBehaviour!="Rollover")&&(n||this.settings.modalBehaviour=="Rollover")){if(this.settings.quickmode){selectedWord=new SelectedWord(this.settings,t.srcElement,!0);return}if(this.modalVisible){this.closeTextModal();return}if(!$(this).hasClass(this.settings.classes.punctuationClass)&&!$(this).hasClass(this.settings.classes.spaceClass)){if(n)switch(this.settings.modalBehaviour){case"LeftClick":if(t.which!=1)return;if(t.altKey||t.shiftKey||t.ctrlKey)return;break;case"CtrlLeftClick":if(t.which!=1||!t.ctrlKey)return;if(t.altKey||t.shiftKey)return;break;case"ShiftLeftClick":if(t.which!=1||!t.shiftKey)return;if(t.altKey||t.ctrlKey)return;break;case"MiddleClick":if(t.which!=2)return;if(t.altKey||t.shiftKey||t.ctrlKey)return;break;case"RightClick":if(t.which!=3)return;if(t.altKey||t.shiftKey||t.ctrlKey)return;break;default:return}this.settings.keyBindings.autoPause&&this.audio.pauseAudio(),selectedWord=new SelectedWord(this.settings,t.srcElement,!1),modal.modal("show")}}},n.prototype.closeTextModal=function(){modal.modal("hide")},n.prototype.markRemainingAsKnown=function(){var t=this,n;this.modalVisible||($("#altMessageArea").removeClass().addClass("alert alert-info").html("saving....").show(),n=[],$("#textContent ."+this.settings.classes.notseenClass).each(function(i,r){$(t).is("sup")||n.push($(r).text())}),$.post(routes.reading.markRemainingAsKnown,{languageId:this.settings.languageId,terms:n,textId:this.settings.textId},function(n){n.result=="OK"?($("#altMessageArea").addClass("alert alert-success"),$("#textContent .nsx").removeClass("nsx").addClass("knx")):$("#altMessageArea").addClass("alert alert-error"),$("#altMessageArea").html(n.message)}))},n.prototype.reviewUnknown=function(){var t=this,n;this.modalVisible||($("#altMessageArea").removeClass().addClass("alert alert-info").html("review unknown words....").show(),n=[],$("#textContent ."+this.settings.classes.unknownClass).each(function(i,r){$(t).is("sup")||n.push($(r).text())}),$.post(routes.reading.reviewUnknown,{languageId:this.settings.languageId,terms:n,textId:this.settings.textId},function(n){n.result=="OK"?($("#altMessageArea").addClass("alert alert-success"),$("#textContent .nsx").removeClass("nsx").addClass("knx")):$("#altMessageArea").addClass("alert alert-error"),$("#altMessageArea").html(n.message)}))},n}(),modal,selectedWord;$("#toggleL1").click(function(){return ui.toggleL1(),!1}),$("#toggleL2").click(function(){return ui.toggleL2(),!1}),$("#quickmode").click(function(){return ui.toggleQuickmode(),!1}),$("#reviewUnknownWords").click(function(){return ui.reviewUnknown(),!1}),$("#markRemainingAsKnown").click(function(){return ui.markRemainingAsKnown(),!1}),$("#btnSave").click(function(){selectedWord.saveChanges()}),$("#btnSaveClose").click(function(){selectedWord.saveChanges(),ui.closeTextModal()}),$("#btnReset").click(function(){selectedWord.resetTerm()}),$("#increaseWord").click(function(){selectedWord.increaseWord()}),$("#decreaseWord").click(function(){selectedWord.decreaseWord()}),$("#minusRead").click(function(){return ui.changeRead(-1),!1}),$("#plusRead").click(function(){return ui.changeRead(1),!1}),$("#minusListened").click(function(){return ui.changeListened(-1),!1}),$("#plusListened").click(function(){return ui.changeListened(1),!1}),$.fn.animateHighlight=function(n,t){var i=n||"#FFFF9C",r=t||1500,u=this.css("backgroundColor");this.stop().css("background-color",i).animate({backgroundColor:u},r)};var termUlTemplate=Handlebars.compile($("#term-ul-template").html()),termDivTemplate=Handlebars.compile($("#term-div-template").html()),termMessageTemplate=Handlebars.compile($("#term-message-template").html());$(function(){if(ui.settings.modalBehaviour=="Rollover")$(document).on("mouseenter","#textContent .knx, #textContent .nkx, #textContent .nsx, #textContent .igx, #textContent .mxx",function(n){ui.openTextModal(!1,n)});else{$(document).on("contextmenu","#textContent .knx, #textContent .nkx, #textContent .nsx, #textContent .igx, #textContent .mxx",function(){return ui.settings.modalBehaviour!="RightClick"});$(document).on("mousedown","#textContent .knx, #textContent .nkx, #textContent .nsx, #textContent .igx, #textContent .mxx",function(n){ui.openTextModal(!0,n)})}modal=$("#myModal");modal.on("show",function(){ui.modalVisible=!0});modal.on("hide",function(){selectedWord.blankModal(),modal.hide(),ui.modalVisible=!1,ui.audio.resumeAudio()});modal.modal({show:!1,keyboard:!0,backdrop:!1})}),$(document).keyup(function(n){var t=n.keyCode?n.keyCode:n.which;if(ui.modalVisible){if(t==27)ui.closeTextModal();else if(n.ctrlKey&&t==13)selectedWord.saveChanges(),ui.closeTextModal();else if(n.altKey)switch(t){case ui.settings.keyBindings.resetWord:selectedWord.resetTerm();break;case ui.settings.keyBindings.changeKnown:selectedWord.changeState("known");break;case ui.settings.keyBindings.changeNotKnown:selectedWord.changeState("notknown");break;case ui.settings.keyBindings.changeIgnored:selectedWord.changeState("ignored");break;case ui.settings.keyBindings.changeNotSeen:selectedWord.changeState("notseen")}}else if(ui.settings.keyBindings.controlsEnabled){if(n.altKey||n.shiftKey||n.ctrlKey)return;switch(t){case ui.settings.keyBindings.volumeUp:ui.audio.increaseVolume();break;case ui.settings.keyBindings.volumeDown:ui.audio.decreaseVolume();break;case ui.settings.keyBindings.speedUp:ui.audio.speedUpAudio();break;case ui.settings.keyBindings.slowDown:ui.audio.slowDownAudio();break;case ui.settings.keyBindings.rewindToBeginning:ui.audio.restartAudio();break;case ui.settings.keyBindings.rewind:ui.audio.rewindAudio();break;case ui.settings.keyBindings.stop:ui.audio.stopAudio();break;case ui.settings.keyBindings.forward:ui.audio.fastForwardAudio();break;case ui.settings.keyBindings.playPause:ui.audio.playAudio()}}});$("#tabTermDefintions").on("click","li",function(n){n.preventDefault(),$(_this).tab("show");var t=$(n.target).data("messageid");$(".itermMessage").hide(),$("#"+t).show()})