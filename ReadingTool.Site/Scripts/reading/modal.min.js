var SelectedWord=function(){function n(n,t){this.settings=n,this.element=t,this.length=1,this.init()}return n.prototype.init=function(){var n=this;this.selectedWord=$(this.element).html(),this.selectedSentence=this.getCurrentSentence(),$("#currentBox").removeClass().addClass("badge"),$.post(this.settings.ajaxUrl+"/find-term",{languageId:this.settings.languageId,termPhrase:this.selectedWord},function(t){console.log(t),t==null&&($("#unknownState").attr("checked",!0),$("#baseTerm").val(""),$("#romanisation").val(""),$("#definition").val(""),$("#tags").val(""),$("#sentence").val(n.selectedSentence),$("#modalMessage").removeClass().addClass("label label-warning").html("new word, defaulted to unknown")),n.updateModalDisplay()})},n.prototype.updateModalDisplay=function(){$("#selectedWord").text(this.selectedWord),this.refreshDictionaryLinks()},n.prototype.saveChanges=function(){$.post(this.settings.ajaxUrl+"/save-term",{},function(n){n.Result=="OK"?($("#modalMessage").removeClass().addClass("label label-success").html(n.Message),$("#currentBox").removeClass().addClass("badge badge-success").html(n.Data.Box)):$("#modalMessage").removeClass().addClass("label label-error").html(n.Message)})},n.prototype.resetWord=function(){console.log("reset word")},n.prototype.refreshSentence=function(){console.log("refresh sentence"),this.sentence=this.getCurrentSentence(),$("#sentence").parent("div").parent("div").hasClass("warning")||$("#sentence").parent("div").parent("div").addClass("warning"),this.updateModalDisplay()},n.prototype.increaseWord=function(){(console.log("increase word"),this.length>=7)||(this.length++,this.changePhrase())},n.prototype.decreaseWord=function(){(console.log("decrease word"),this.length<=1)||(this.length--,this.changePhrase())},n.prototype.refreshDictionaryLinks=function(){var n=this;$(".dictionary").each(function(t,i){var r=$(i),e=r.data("id"),o=r.data("parameter"),s=r.data("urlencode"),h=r.data("url"),u=r.data("autoopen"),f=o=="sentence"?n.selectedSentence:n.selectedWord;u==undefined&&(u=!1),s?$.post(n.settings.ajaxUrl+"/encode-term",{languageId:n.settings.languageId,dictionaryId:e,input:f},function(n){n.Result=="OK"&&(r.attr("href",n.Message),u&&(r[0].click(),console.log(u)))}):(r.attr("href",h.replace("###",f)),u&&r[0].click())})},n.prototype.changePhrase=function(){var t="",i=0,n=$(this.element);do{if(n==null)break;if(n.attr("class")==this.settings.classes.spaceClass||n.attr("class")==this.settings.classes.punctuationClass||n.attr("class")==this.settings.classes.multiClass||n.is("sup")){n=n.next();continue}t+=n.text()+" ",n=n.next(),i++}while(i<this.length);this.selectedWord=t,this.updateModalDisplay()},n.prototype.getCurrentSentence=function(){var t,r;console.log("get current sentence");var i=$(this.element).parent(),u=i.children(),n=this.buildSentence(u);return n.length<25&&(t=i.prev(),t!=null&&(n=this.buildSentence(t.children())+" "+n)),n.length<25&&(r=i.next(),t!=null&&(n=n+" "+this.buildSentence(r.children()))),n},n.prototype.buildSentence=function(n){var t="";return n.each(function(n,i){if(i.nodeName!="SUP"){var r=i.textContent;r==""&&(r=i.innerText),t+=r}}),$.trim(t)},n}()