var SelectedWord=function(){function n(n,t){this.settings=n,this.element=t,this.length=1,this.selectedWord=$(this.element).html(),this.selectedSentence=this.getCurrentSentence(),this.findTerm()}return n.prototype.findTerm=function(){var n=this;$("#currentBox").removeClass().addClass("badge"),$.post(this.settings.ajaxUrl+"/find-term",{languageId:this.settings.languageId,termPhrase:this.selectedWord},function(t){console.log(t),n.updateModalDisplay(),n.createTemplate(t)})},n.prototype.createTemplate=function(n){var r=termUlTemplate(n),u=termDivTemplate(n),f=termMessageTemplate(n),i,t;for($("#tabTermDefintions").html(r),$("#tabContent").html(u),$("#termMessages").html(f),$("#currentBox").html(n.box),$("#termMessage").html(n.message),$("#termId").val(n.id),n.id=="00000000-0000-0000-0000-000000000000"&&$("#termMessage").removeClass("label-info").addClass("label-warning"),n.stateClass==this.settings.classes.knownClass?$("#knownState").attr("checked",!0):n.stateClass==this.settings.classes.unknownClass?$("#unknownState").attr("checked",!0):n.stateClass==this.settings.classes.ignoredClass?$("#ignoredState").attr("checked",!0):$("#notseenState").attr("checked",!0),i=0;i<n.individualTerms.length;i++)t=n.individualTerms[i],$("#sentence"+t.id).val(t.sentence),$("#baseTerm"+t.id).val(t.baseTerm),$("#romanisation"+t.id).val(t.romanisation),$("#definition"+t.id).val(t.definition),$("#tags"+t.id).val(t.tags),t.id=="00000000-0000-0000-0000-000000000000"&&($("#itermMessage"+i).removeClass("label-info").addClass("label-important"),$("#sentence"+t.id).val(this.selectedSentence));$("#tabTermDefintions a:first").tab("show"),$("#itermMessage0").show()},n.prototype.updateModalDisplay=function(){$("#selectedWord").text(this.selectedWord),$("#termPhrase").val(this.selectedWord),this.refreshDictionaryLinks()},n.prototype.saveChanges=function(){var t=this,n=$("#tabTermDefintions li.active").index();n<0&&(n=1),$.post(this.settings.ajaxUrl+"/save-term",$("#formTerms").serialize(),function(i){i.result=="OK"?($("#termMessage").removeClass("label-info").addClass("label-success").html(i.message),t.createTemplate(i.data),$("#tabTermDefintions a").eq(n).tab("show"),t.updateModalDisplay()):$("#termMessage").removeClass("label-info").addClass("label-error").html(i.message)})},n.prototype.resetWord=function(){console.log("reset word")},n.prototype.refreshSentence=function(n){console.log("refresh sentence"),this.sentence=this.getCurrentSentence(),$(n).hasClass("refresh")||$(n).addClass("refresh"),$(n).val(this.sentence),this.updateModalDisplay()},n.prototype.increaseWord=function(){(console.log("increase word"),this.length>=7)||(this.length++,this.changePhrase(),this.findTerm())},n.prototype.decreaseWord=function(){(console.log("decrease word"),this.length<=1)||(this.length--,this.changePhrase(),this.findTerm())},n.prototype.refreshDictionaryLinks=function(){var n=this;$(".dictionary").each(function(t,i){var r=$(i),e=r.data("id"),o=r.data("parameter"),s=r.data("urlencode"),h=r.data("url"),u=r.data("autoopen"),f=o=="sentence"?n.selectedSentence:n.selectedWord;u==undefined&&(u=!1),s?$.post(n.settings.ajaxUrl+"/encode-term",{languageId:n.settings.languageId,dictionaryId:e,input:f},function(n){n.Result=="OK"&&(r.attr("href",n.Message),u&&(r[0].click(),console.log(u)))}):(r.attr("href",h.replace("###",f)),u&&r[0].click())})},n.prototype.changePhrase=function(){var t="",i=0,n=$(this.element);do{if(n==null)break;if(n.attr("class")==this.settings.classes.spaceClass||n.attr("class")==this.settings.classes.punctuationClass||n.attr("class")==this.settings.classes.multiClass||n.is("sup")){n=n.next();continue}t+=n.text()+" ",n=n.next(),i++}while(i<this.length);this.selectedWord=t,this.updateModalDisplay()},n.prototype.getCurrentSentence=function(){var t,r;console.log("get current sentence");var i=$(this.element).parent(),u=i.children(),n=this.buildSentence(u);return n.length<25&&(t=i.prev(),t!=null&&(n=this.buildSentence(t.children())+" "+n)),n.length<25&&(r=i.next(),t!=null&&(n=n+" "+this.buildSentence(r.children()))),n},n.prototype.buildSentence=function(n){var t="";return n.each(function(n,i){if(i.nodeName!="SUP"){var r=i.textContent;r==""&&(r=i.innerText),t+=r}}),$.trim(t)},n}()